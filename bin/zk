#!/usr/bin/env ruby

require "docopt"

require_relative "../lib/zombie_killer"

doc = <<-EOT
Zombie Killer -- tool to kill YCP zombies

Usage: zk [options] <files>...

Options:
  -u, --unsafe               Translate even constructs not known to be safe.
  -s, --stats                Also print statistics about node types.
  -h, --help                 Print help and exit.
EOT

begin
  options = Docopt.docopt(doc, help: true, version: ZombieKiller::VERSION)

  killer = ZombieKiller.new
  options["<files>"].each do |file|
    killer.kill_file(file, file, unsafe: options["--unsafe"])

    if options["--stats"]
      counter = NodeTypeCounter.new(file)
      counter.print($stderr)
    end
  end
rescue Docopt::Exit => e
  abort e.message
end
